<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/vaadin-form-layout/vaadin-form-layout.html">
<link rel="import" href="../../../bower_components/vaadin-form-layout/vaadin-form-item.html">
<link rel="import" href="../../../bower_components/vaadin-split-layout/vaadin-split-layout.html">
<link rel="import" href="../../bower_components/vaadin-valo-theme/vaadin-text-field.html">
<link rel="import" href="../../../bower_components/vaadin-text-field/vaadin-text-field.html">
<link rel="import" href="../../bower_components/vaadin-valo-theme/vaadin-combo-box.html">
<link rel="import" href="../../bower_components/vaadin-combo-box/vaadin-combo-box.html">
<link rel="import" href="../omp-builder/omp-builder.html">
<link rel="import" href="../omp-blotter/omp-blotter.html">
<link rel="import" href="../omp-execution/omp-execution.html">
<dom-module id="omp-app">
    <template>
        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
        <style >
         vaadin-form-layout.with-text-fields > vaadin-text-field {
             margin-top: .5em;
             margin-bottom: .5em;
         }
         label{
             text-transform: uppercase !important;
         }
        </style>
        <div class="container">
            <div id="topbar" class="row">
                <div class="col-3">
                    <vaadin-combo-box id="user" label="User" items="{{users}}" on-value-changed="userChanged" value="igor"></vaadin-combo-box>
                </div>
                <div class="col-3">
                    <vaadin-combo-box id="portfolio" label="Portfolio" items="[[portfolios]]" on-value-changed="portfolioChanged"></vaadin-combo-box>
                </div>
                <div class="col-3">
                    <vaadin-combo-box id="asset-class" label="Asset class" items="[[assetClasses]]" value="{{selectedAssetClass}}"></vaadin-combo-box>
                </div>
                <div class="col-3">
                    <vaadin-combo-box id="broker" label="Broker" items="[[brokers]]" value="{{selectedBroker}}"></vaadin-combo-box>
                </div>
            </div>
            <div id="builder" class="row mt-4">
                <omp-builder class="col"></omp-builder>
            </div>
            <div id="blotter" class="row">
                <omp-blotter class="col"></omp-blotter>
            </div>
            <div id="execution" class="row">
                <omp-execution class="col"></omp-execution>
            </div>
        </div>
    </template>
    <script>
     class OmpApp extends Polymer.Element{
         static get is() { return 'omp-app'; }
         static get properties(){
             return {
                 title: {
                     type: String,
                     value: "Order Management System TEST"
                 },
		 users: {
		     type: Array,
		     value: () => ['igor', 'uma', 'marcel', 'eljon', 'robert']
		 },

		 _userData: {
		     type: Object,
		     value: () => {}
		 }
             }
         }

	 /* connectedCallback(){

	    }*/
	 userChanged(ev) {
	     axios.get(`/login/${ev.target.value}`)
		  .then( function(res){
		      this.set('_userData', res.data);
		      this.set('portfolios', this._userData.portfolios.map((x) => x.portfolio_id))

		      this.$.portfolio.value = this.portfolios[0]
		      
		  }.bind(this))
	 }

	 portfolioChanged(ev){
	     /* console.log(this.get('selectedPortfolio'))*/
	     /* console.log(this._userData);*/
	     debugger
	     if ( this._userData != undefined) {
		this._userData.assetClasses.find(function(a){
		    if ( a.portfolio_id === this.$.portfolio.value) {
			this.$['asset-class'].items = a.assetclasses
			this.$['asset-class'].value = a.assetclasses[0]
			 return
		     }
		 }.bind(this))


	     }

	 }
     }
     customElements.define(OmpApp.is, OmpApp);
    </script>
</dom-module>
